---
title: Docker实战系列 — 镜像
_date: 9 Apr 2015
---

### 好高端的词汇

在我看来，没亲自装过系统的，就别说自己玩过电脑。当然，现在装一般的Windows系统已经完全没有技术含量可言。

我第一次接触镜像这个词就是装系统的时候，镜像的概念可以去百度词条看看。Docker的镜像是分层的，上一节中执行pull命令的时候应该看得到，pull了好几层。里面的知识太深奥，我也不懂。其次Docker的镜像只是提供了一个只读层，意即给了一个大环境，你可以理解为就是一个系统环境，然而目前它是不可更改的。

### Git-like的操作
DockerHub就和GitHub一样，保存着海量的镜像文件提供下载，当你使用pull的时候默认就是从那里面去搜索镜像，然后下载到本地。上一节的那个命令等同于

`# Docker pull egistry.hub.docker.com/ubuntu`

国内也有Docker镜像的提供者，如[Dockerpool](http://dockerpool.com/)如果要下载这些网站的镜像，可以去看那些网站里提供的教程。这里你可能遇到的问题就是需要配置一下Docker文件。

在本地，可以使用save/load命令来保存镜像文件到本地和加载本地的镜像文件。

`# docker	 save	 -o 	ubuntu_14.04.tar	 ubuntu:14.04`

`# docker	 load	 < 	ubuntu_14.04.tar`

注意：我列出的命令并不是唯一的方法，更多的去看官方的文档。并且我推荐使用save/load，这会保存镜像以及其相关的元数据信息(包括标签等)。

一般，我希望你去DockerHub注册一个帐号，这样可以用来==push==你重新制作的镜像到云端，提供给别的主机下载使用。我强调是你==重新制作==的，哪怕是你重命名了一个镜像也算。所以我接下来要详细介绍，如何正确的上传你的镜像。

这里假定镜像为ubuntu：14.04.1，ID 为cde5bc7c4c8b。这是我们直接从官方库pull下来的。此时如果我们试图上传这个镜像，首先是登录你的帐号

`# docker login   根据提示输入帐号密码`

`# docker push cde5   这个命令执行后会出现错误，如果不出意外`

`# FATA[0000] You cannot push a "root" repository....`

错误提示你不能上传一个“root”仓库。其原因就是这个镜像是基础镜像，默认会给你上传到"root"仓库，当然这是不允许的，这样会使得管理乱套的。那么我们需要重命名一下，告诉docker这是我的镜像了。使用docker tag命令就可以了

`# docker tag cde5 docker.io/user/repo:tag    这里的user为你的用户名,repo与tag随意`

现在再去列出所有镜像，你会发现多了一个你自己创建的镜像，然而ID并没有变，因为只是名字不同而已，实质上没有变化。我们可以使用docker rmi去删除那个基础镜像（删除前确保没有容器在使用这个镜像）。

`# docker rmi ubunut:14.04.1    这里需要用名字加tag,可以接多个，用ID的话就都删了`

那么我们再次使用上传命令，但操蛋的是错误又出现了。

`# FATA[0001] Repository does not exist: docker.io/user/repo`

很明显，就是找不到该用户的仓库。那么我们需要去DockerHub在自己的用户名下新建一个仓库。至于名字就取repo的名字。之后，使用push命令时如果使用ID的话依然会出现基础镜像错误，这是因为其实质并没有变化。但用名字加tag的话，就会重新改写镜像的一些信息，然后再上传，完成后就可以在DockerHub的个人中心看到你上传的镜像了。

### 总结一下 ###

前一部分简单说了拉取镜像，存入导出的基本操作，当然还有其他操作诸如search，这个自己去看帮助文档，其实是可以举一反三的。后一部分着重说了推送到个人中心的操作和常见错误。如果你还发现其他问题，欢迎emial me：**yp_liuwei@163.com**。

---
>很多时候要保持对知识的渴望，我的建议是能看懂官方的文档尽量去看官方的手册，那是最精简的所在。
